# 노드 여러분, 트랜잭션을 승인합니까? (p141 ~ p150)

디지털 서명 만들어 검증에 사용하기

<br>

> **비유: 자필 서명**  
> `자필 서명`은 문서의 내용에 동의하고 문서 내용을 집행하는 데 동의한다는 중요한 의미를 갖는다. 우리가 `자필 서명`을 동의의 증거로 받아들이는 이유는, **사람마다 고유한 특징을 가지기** 때문이다. 자신만의 독특한 방식으로 쓰여진 이름을 식별하면 서명을 한 사람이 맞다는 결론을 내릴 수 있고, 결과적으로 그 사람이 문서의 내용과 그 실행에 동의했다는 결론을 내릴 수 있다.
>
> 이 자필 서명은 블록체인의 `전자 원장`(electronic ledger)에, **트랜잭션에 동의**한다고 표시하는 개념과 유사하다.

<br>

## 1. 목표

계정의 소유자만이 계정 내 자산을 다른 계정으로 이전할 수 있도록 보장하는 것

- 합법적 소유자가 아닌 모든 사람은, 승인 거부해야함

<br>

## 2. 해결해야 할 과제

P2P 시스템에서 `소유권 이전`은 계정의 합접적 소유자만 가능한 반면, 모든 사람이 트랜잭션을 생성하고 제출할 수 있도록 개방성을 유지해야 함

<br>

## 3. 아이디어

"자필 서명의 기능을 디지털 버전으로 만들어 보안 수단으로 활용"

- 디지털 서명을 이용해 게정을 식별
- 특정 트랜잭션 데이터 내용에 대한 소유자의 동의 표시
- 데이터를 트랜잭션 데이터 이력에 추가하도록 허가함으로써 그 실행을 승인

<br>

## 4. 디지털 서명의 주요 기능 알아보기

암호화 해싱과 비대칭 암호화 기법의 `개인-공개` 방식의 정보 흐름 활용

디지털 서명의 3대 주요 요소,

### 1 | 서명의 생성

Hello World!라는 인사말을 승인 방식으로 보내고 싶다는 가정

#### 인사말을 담은 메시지와 디지털 서명 생성 프로세스

![블록체인_무엇인가-_디지털_서명_예시](https://github.com/lbo728/BlockChainStudy/assets/72309817/e815d7ff-cb2e-4f37-bf25-e1be15601e86)

1. 인사말을 담은 **흰 상자**에서 시작
2. 인사말의 **해시값 7F83B165**를 생성
3. 생성된 해시값을 `개인 키`를 사용해 **암호화**
4. 인사말 해시값의 암호문(**흰 글자가 있는 검은 상자**)이 바로 인사말에 대한 `디지털 서명`
5. **회색 상자(인사말 + 디지털 서명)** → 세상에 보내는 디지털 서명된 메시지 완성

<br>

##### 고유성을 가질 수 있는 이유

1. 고유한 `개인 키`를 사용했기 때문에 누가 생성했는지 특정 가능
2. `디지털 서명`에 기반해 생성되어, 인사말의 내용이 고유함

<br>

### 2 | 서명을 이용한 데이터 검증

모든 사람이 나의 `공개 키`를 활용하면 이 메시지는 내가 승인한 메시지라는 것을 알 수 있음

#### 디지털 서명을 이용해 메시지를 검증하는 프로세스

![블록체인_무엇인가-디지털_서명_메시지_검증](https://github.com/lbo728/BlockChainStudy/assets/72309817/63d9fe88-2b99-4538-9e82-c5c571f8bbb5)

1. 인사말에서 시작
2. 인사말을 받은 메시지 수신자는 먼저 인사말의 해시값을 스스로 계산
   → 계산한 값은 7F83B165
3. 첨부된 `암호문(디지털 서명)`을 `공개 키`를 사용해 복호화하여 7F83B165라는 값을 얻는다.
   → 이 값은 내가 최초에 보내려고 한 인사말의 해시값
4. 양쪽 값이 일치하므로 수신자는 두 가지 사실을 알 수 있음

   1. 이 메시지는 내가 서명했다.

      - 나의 `공개 키`를 사용해 서명을 복호화할 수 있었기 떄문

   2. 메시지의 인사말이 원래 보내려한 것과 동일

      - 복호화된 암호문이 메시지 인사말의 `해시값`과 일치하기 때문

### 3 | 서명을 이용한 사기 식별

#### 디지털 서명으로 인사말의 위조 사실 판별

![블록체인_무엇인가-디지털_서명_사기식별 (1)](https://github.com/lbo728/BlockChainStudy/assets/72309817/1efc8b85-4cf3-4407-b043-d85e5c0e2e28)
<인사말이 변경됨>

1. 메시지 수신자는 먼저 인사말의 해시값을 스스로 생성함
   → 그 값은 8A0B7C66
2. 나의 공개 키를 이용해 디지털 서명을 복호화
   → 원래 인사말의 해시값은 7F83B165
3. 해시값이 일치하지 않음
   → 두 메시지는 다름

<br>

## 5. 작동 원리

블록체인의 디지털 서명은 다음의 요구사항을 만족한다.

- 트랜잭션 데이터는 계정의 소유자가 **소유권을 이전하는 데 동의했다는** 사실을 알려준다.
- 트랜잭션의 전체 내용은 고유하므로 **서명한 사람의 동의 없이** 다른 트랜잭션의 서명으로 사용할 수 없다. 트랜잭션 내용이 바뀌면 소유자가 새로 서명을 생성해야 한다.
- **소유권을 이전하려는 계정의 소유자만이** 서명을 생성할 수 있다.
- 누구나 **쉽게 검증할** 수 있다.

<br>

### 1 | 트랜잭션 서명

디지털 서명 단계

1.  계정 번호, 이체 총액 등 **트랜잭션에 필요한 모든 정보**를 기술한다.

    - 이때, 디지털 서명은 아직 생성되지 않았으므로 제외

2.  트랜잭션 데이터의 **암호화 해시값을 생성**한다.
3.  소유권을 이전하려는 게정의 `개인 키`를 사용해 트랜잭션의 해시값을 `암호화`한다.
4.  3번에서 생성한 암호문을 트랜잭션에 `디지털 서명`으로 첨부한다.

<br>

### 2 | 트랜잭션 검증

트랜잭션 검증 단계

1. `서명`을 제외하고 검증할 **트랜잭션 데이터의 해시값을 생성**한다.
2. 검증하려는 트랜잭션의 디지털 서명을`복호화`한다.
3. 1번에서 얻은 해시값과 2번에서 얻은 값을 비교한다.
   → 두 값이 동일하면 소유권을 이전하려는 계정에 해당하는 `개인 키` 소유자가 승인한 트랜잭션이고, 두 값이 다르면 그렇지 않다는 결론을 내린다.

<br>

## 6. 작동하는 이유

트랜잭션 데이터의 디지털 서명은 다음 두 가지의 조합이다.

- 계정의 `개인 키`로 추적해서 특정할 수 있는 **암호문**
- 트랜잭션 데이터의 **암호화 해시값**

→ 즉, 소유권을 이전하려는 계정의 `개인 키`를 이용해 암호화한 **트랜잭션 데이터의 암호화 해시값**

> - **암호화 해시값**: 디지털 지문
>   - 각 트랜잭션마다 고유한 값을 가짐
> - `공개-개인-키` 암호화 기법의 속성상 특정 키로 생성된 암호문은, 오로지 상응하는 키로만 `복호화` 가능
>
> 즉, **디지털 서명을 생성하는데 사용한** `개인 키`를 소유한 사람이 그 트랜잭션의 내용에 동의했음을 증명하는 증거로 사용할 수 있음
